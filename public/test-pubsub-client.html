<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SafeEscape Pub/Sub Test Client</title>
  <script src="https://cdn.socket.io/4.4.1/socket.io.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      color: #2c3e50;
    }
    .card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      background-color: #f9f9f9;
    }
    .emergency {
      border-left: 5px solid #e74c3c;
    }
    .warning {
      border-left: 5px solid #f39c12;
    }
    .evacuation {
      border-left: 5px solid #8e44ad;
    }
    .system {
      border-left: 5px solid #3498db;
    }
    .controls {
      margin-bottom: 20px;
      padding: 15px;
      background-color: #ecf0f1;
      border-radius: 8px;
    }
    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }
    button:hover {
      background-color: #2980b9;
    }
    #notifications {
      max-height: 500px;
      overflow-y: auto;
    }
    .timestamp {
      color: #7f8c8d;
      font-size: 0.8em;
    }
    .severity-high {
      color: #e74c3c;
      font-weight: bold;
    }
    .severity-medium {
      color: #f39c12;
      font-weight: bold;
    }
    .severity-low {
      color: #3498db;
    }
    input, select {
      padding: 8px;
      margin-right: 10px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
  </style>
</head>
<body>
  <h1>SafeEscape Pub/Sub Test Client</h1>
  
  <div class="controls">
    <h3>Connection</h3>
    <input type="text" id="serverUrl" value="http://localhost:5000" placeholder="Server URL">
    <button id="connectBtn">Connect</button>
    <button id="disconnectBtn">Disconnect</button>
    <span id="connectionStatus">Disconnected</span>
    
    <h3>User Registration</h3>
    <input type="text" id="userId" placeholder="User ID">
    <input type="text" id="city" placeholder="City" value="Mumbai">
    <input type="text" id="state" placeholder="State" value="Maharashtra">
    <button id="registerBtn">Register</button>
  </div>
  
  <h2>Notifications</h2>
  <button id="clearBtn">Clear All</button>
  <div id="notifications"></div>
  
  <script>
    let socket;
    
    // DOM elements
    const connectBtn = document.getElementById('connectBtn');
    const disconnectBtn = document.getElementById('disconnectBtn');
    const registerBtn = document.getElementById('registerBtn');
    const clearBtn = document.getElementById('clearBtn');
    const serverUrlInput = document.getElementById('serverUrl');
    const userIdInput = document.getElementById('userId');
    const cityInput = document.getElementById('city');
    const stateInput = document.getElementById('state');
    const connectionStatus = document.getElementById('connectionStatus');
    const notificationsContainer = document.getElementById('notifications');
    
    // Connect to Socket.IO server
    connectBtn.addEventListener('click', () => {
      const serverUrl = serverUrlInput.value;
      
      if (!serverUrl) {
        alert('Please enter a server URL');
        return;
      }
      
      try {
        // Disconnect existing socket if any
        if (socket) {
          socket.disconnect();
        }
        
        // Connect to server
        socket = io(serverUrl);
        
        // Connection events
        socket.on('connect', () => {
          connectionStatus.textContent = 'Connected';
          connectionStatus.style.color = 'green';
          addNotification('System', 'Connected to server', 'info');
        });
        
        socket.on('disconnect', () => {
          connectionStatus.textContent = 'Disconnected';
          connectionStatus.style.color = 'red';
          addNotification('System', 'Disconnected from server', 'info');
        });
        
        socket.on('connect_error', (error) => {
          connectionStatus.textContent = 'Connection Error';
          connectionStatus.style.color = 'red';
          addNotification('System', `Connection error: ${error.message}`, 'error');
        });
        
        // Alert events
        socket.on('emergency-alert', (data) => {
          addNotification('Emergency Alert', data.alert.title, data.attributes.severity, data.alert);
        });
        
        socket.on('disaster-warning', (data) => {
          addNotification('Disaster Warning', data.warning.title, data.attributes.severity, data.warning);
        });
        
        socket.on('evacuation-notice', (data) => {
          addNotification('Evacuation Notice', `Evacuation: ${data.notice.area.name}`, data.attributes.severity, data.notice);
        });
        
        socket.on('critical-alert', (data) => {
          addNotification('CRITICAL ALERT', data.alert.title, 'critical', data.alert);
        });
        
        socket.on('critical-evacuation', (data) => {
          addNotification('CRITICAL EVACUATION', `Evacuate: ${data.notice.area.name}`, 'critical', data.notice);
        });
        
        socket.on('system-notification', (data) => {
          addNotification('System Notification', data.notification.title, data.attributes.severity, data.notification);
        });
        
        socket.on('registered', (data) => {
          addNotification('Registration', data.message, data.success ? 'info' : 'error');
        });
      } catch (error) {
        connectionStatus.textContent = 'Connection Failed';
        connectionStatus.style.color = 'red';
        addNotification('System', `Failed to connect: ${error.message}`, 'error');
      }
    });
    
    // Disconnect from server
    disconnectBtn.addEventListener('click', () => {
      if (socket) {
        socket.disconnect();
        socket = null;
      }
    });
    
    // Register user
    registerBtn.addEventListener('click', () => {
      if (!socket) {
        alert('Please connect to the server first');
        return;
      }
      
      const userId = userIdInput.value;
      const city = cityInput.value;
      const state = stateInput.value;
      
      if (!userId) {
        alert('Please enter a user ID');
        return;
      }
      
      // Register with server
      socket.emit('register', {
        userId: userId,
        location: {
          city: city,
          state: state
        }
      });
      
      addNotification('System', `Registering user: ${userId}`, 'info');
    });
    
    // Clear notifications
    clearBtn.addEventListener('click', () => {
      notificationsContainer.innerHTML = '';
    });
    
    // Add notification to the UI
    function addNotification(type, message, severity = 'info', data = null) {
      const card = document.createElement('div');
      card.className = `card ${getCardClass(type)}`;
      
      const timestamp = new Date().toLocaleTimeString();
      
      let content = `
        <div class="timestamp">${timestamp}</div>
        <h3>${type}</h3>
        <p class="severity-${severity}">${message}</p>
      `;
      
      if (data) {
        content += `<details>
          <summary>Details</summary>
          <pre>${JSON.stringify(data, null, 2)}</pre>
        </details>`;
      }
      
      card.innerHTML = content;
      
      // Add to container
      notificationsContainer.prepend(card);
    }
    
    // Get card class based on notification type
    function getCardClass(type) {
      const typeMap = {
        'Emergency Alert': 'emergency',
        'CRITICAL ALERT': 'emergency',
        'Disaster Warning': 'warning',
        'Evacuation Notice': 'evacuation',
        'CRITICAL EVACUATION': 'evacuation',
        'System Notification': 'system',
        'System': 'system',
        'Registration': 'system'
      };
      
      return typeMap[type] || 'system';
    }
  </script>
</body>
</html> 